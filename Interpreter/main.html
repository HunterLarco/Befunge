<html>
<head>
<style>
body{
  margin:0px;
  padding:0px;
}
.pre{
	white-space: pre;
	word-wrap: break-word;
	word-break: break-all;
  
  font-family:monospace;
  
  padding:20px;
  font-size:16px;
}
.source{
  background:rgb(245,245,245);
  border-bottom:1px solid rgb(200,200,200);
}
span.active{
  background:rgb(51,51,51) !important;
  color:rgb(245,245,245) !important;
}

span:nth-child(2n+1){
  background:rgb(220,220,220);
}
</style>

<title>Befunge Interpreter</title>

<script src='interpreter.js'></script>
<script src='interfaces/eventlistener.js'></script>
  
</head>
<body>


<div class='pre source'></div>
<div class='pre output'></div>


<script>
(function(){
  var code = [
    'v  >v      <  "This is the fifth line  "\\  ;@  _#;<',
    '0   :      ^                               ;>4-^   ',
    '    5      ^  "This is the fourth line "\\  ;^ :_#;<',
    '    2      ^                               ;>3-^   ',
    '    *      ^  "This is the third line  "\\  ;^ :_#;<',
    '   ,-      ^                               ;>2-^   ',
    '   ^_v     ^  "This is the second line "\\  ;^ :_#;<',
    '     ,     ^                               ;>1-^   ',
    '     >1+v  ^  "This is the first line  "\\  ;^ :_#;<',
    '>       >                            52*\\   :0-^   '
  ];
  
  window.addEventListener('load', Init);
  function Init(){
    var interpreter = new Interpreter(code.join('\n'));
    interpreter.addEventListener('step', OnStep);
    // interpreter.run(15);
    window.interpreter = interpreter;
    // console.log(interpreter.getStack());
    // console.log(interpreter.getConsole());
    // console.log(interpreter.getSource());
    // console.log(interpreter.getExecutedSource());
  }
  
  function OnStep(event){
    var interpreter = event.target;
    var source = interpreter.getExecutedSource().split('\n');
    var loc = interpreter.getLocation();
    
    var newSource = '';
    
    for(var y=0; y<source.length; y++){
      var line = source[y];
      for(var x=0; x<line.length; x++){
        var char = line[x];
        if(loc.x == x && loc.y == y)
          newSource += '\<span class="active">' + char + '\</span>';
        else
          newSource += '\<span>' + char + '\</span>';
      }
      newSource += '\n';
    }
    
    document.querySelector('.source').innerHTML = newSource.slice(0, -1);
    document.querySelector('.output').innerHTML = interpreter.getConsole();
  }
  
})();
</script>
</body>
</html>